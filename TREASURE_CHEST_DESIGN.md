# 宝箱系统设计方案 (Treasure Chest System Design) v1.1

**文档版本**: 1.1 (Revised based on feedback)  
**设计目标**: 引入宝箱机制，提供直接爽快的奖励反馈，同时保留解谜趣味，简化交互流程。

---

## 1. 核心视觉与基础设定 (Core Visuals & Basics)

- **物件**: 宝箱 (Treasure Chest)，占地 1x1。
- **密度**: 
  - **规则**: 约陷阱数量的 1/20。
  - **保底**: 每张地图至少 3 个。
- **动画 (3帧)**:
  1. `chest_closed`: 关闭状态。
  2. `chest_half`: 开启中/半开。
  3. `chest_open`: 完全开启 (空箱)。

---

## 2. 交互流程 (Interaction Flow)

**核心原则**: 不依赖控制台输入，所有交互在独立的 **UI 窗口** 中闭环完成。

1. **触发**: 玩家触碰宝箱 -> 游戏暂停 (World Pause) -> 播放开启前置动画 (Closed -> Half)。
2. **UI 弹出**: 显示 `ChestInteractUI`，背景半透明遮罩。
3. **判定类型**:
   - **普通宝箱 (Normal)**: UI 显示“发现宝藏！”，点击 **[打开]** 按钮即可。
   - **谜题宝箱 (Puzzle)**: 
     - UI 显示一道谜题（数学题、逻辑题或常识题）。
     - UI 提供 **输入框** 或 **选项按钮** (A/B/C)。
     - 玩家直接在界面操作解答。
       - **正确**: 播放开启音效 -> 获得奖励。
       - **错误**: 宝箱锁死或给予少量安慰奖 (如 1 金币)，然后关闭。
4. **结算**:
   - 播放开启后置动画 (Half -> Open)。
   - 展示获得的战利品。
   - 关闭 UI -> 游戏恢复 -> 宝箱变为“已开启”状态 (永久失效)。
   - 玩家离开后，宝箱播放反向动画 (Open -> Half -> Closed) 并保持关闭外观，或者消失（视具体实现难度，保留关闭外观更符合“反着即使播放”的需求）。

---

## 3. 奖励体系 (Reward System)

摒弃复杂的技能点、地图解锁等机制，专注于**即时反馈**和**生存/战斗辅助**。

### 3.1 关卡模式 (Level Mode)
**定位**: 探索惊喜与资源补充。
- **奖励池**:
  1. **强力武器**: 高级剑、魔法杖等 (直接加入背包)。
  2. **大量金币**: 用于商店消费。
  3. **生命恢复**: "古代药水"，直接恢复 1-3 点生命值。
  4. **无敌状态**: 给予 15秒 的长时间无敌 (Invincibility Buff)。

### 3.2 无尽模式 (Endless Mode)
**定位**: 极限生存的关键补给。
- **奖励池**:
  1. **急救包 (Medkit)**: 极其珍贵的生命恢复 (+1 Life)。
  2. **强力 Buff (持续至本层结束或时间限制)**:
     - **极速 (Speed Boost)**: 移速提高 50%。
     - **狂暴 (Rage)**: 攻击冷却减半。
     - **护盾 (Shield)**: 抵挡下一次伤害。
  3. **战术清场**: 
     - 获得“电磁脉冲 (EMP)”道具效果，直接对全屏敌人造成伤害或眩晕。

---

## 4. 谜题设计 (Puzzle Mechanics - Internal UI)

谜题库将内置于代码中，不再通过 Console 交互。
**示例题库**:
- **数学**: "15 * 4 = ?" (输入: 60)
- **记忆**: "当前是第几层?" (选择题)
- **逻辑**: "什么东西早上四条腿，中午两条腿...?" (选择: 人/狗/桌子)

---

## 5. 详细开发计划

### 5.1 数据模型 (`TreasureChest.java`)
```java
public class TreasureChest extends GameObject {
    private boolean isLocked; // 是否需要解谜
    private Puzzle puzzle;    // 如果 locked，对应的谜题
    // ...
}
```

### 5.2 界面 (`ChestInteractUI.java`)
- 继承 `Table`，居中显示。
- 包含 `Label` (问题/描述), `TextField` (输入), `TextButton` (提交/打开)。
- 独立处理输入事件，不传递给 `GameScreen`。

### 5.3 动画逻辑
- 严格遵循用户要求的“玩家触碰 -> 播放 1->2->3 -> UI -> 关闭时 3->2->1”。
- 需要在 `ChestInteractUI` 关闭的回调中触发反向动画。

---

**变更总结**:
- ❌ 移除: 迷雾解锁、技能点系统、陷阱箱、控制台输入解谜。
- ✅ 新增: 纯 UI 解谜、即时 Buff 奖励、更爽快的直接奖励。
